<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8" />
  <title th:text="${music.title} + ' - DoomChit'">곡 정보</title>

  <link rel="stylesheet" href="../static/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../static/css/fontawesome-all.min.css" />
  <link rel="stylesheet" href="../static/css/main.css" />
</head>

<body>

<div id="contents" class="container-xl">

  <!-- =====================
       🎵 곡 정보
  ====================== -->
  <div id="music-summary" class="row pb-4">
    <div class="col-md-3">
      <img class="w-100"
           th:src="${music.image}"
           alt="album"/>
    </div>

    <div class="col">
      <h3 th:text="${music.title}">곡 제목</h3>
      <h4 th:text="${music.artist}">가수명</h4>

      <dl>
        <dt>발매일</dt>
        <dd th:text="${music.relDate}">2026.01.07</dd>
        <dt>장르</dt>
        <dd th:text="${music.genre}">장르</dd>
      </dl>
    </div>
  </div>

  <!-- =====================
       💬 리뷰 영역
  ====================== -->
  <div id="reviews">

    <h2 class="pb-2 border-bottom">
      리뷰 <span th:text="${#lists.size(reviewList)}">0</span>개
    </h2>

    <!-- 🔐 로그인 안내 -->
    <div sec:authorize="isAnonymous()"
         class="bg-body-secondary rounded mb-4 p-3">
      댓글을 입력하려면 <a th:href="@{/user/login}">로그인</a>이 필요합니다.
    </div>

    <!-- ✍️ 리뷰 작성 -->
    <div sec:authorize="isAuthenticated()"
         class="border rounded p-3 mb-4">

      <form th:action="@{/review/create/{mno}(mno=${music.mno})}"
            method="post">

        <textarea name="content"
                  class="form-control border mb-3"
                  placeholder="리뷰를 작성해줘!"
                  required></textarea>

        <div class="text-end">
          <button class="btn btn-primary" type="submit">
            리뷰 등록하기
          </button>
        </div>
      </form>
    </div>

    <!-- 📄 리뷰 목록 -->
    <div th:each="review : ${reviewList}"
         class="border-bottom p-3 mb-3">

      <p th:text="${review.content}"
         style="white-space: pre-wrap;"></p>

      <dl class="d-flex justify-content-between">
        <div>
          <dt th:text="${review.user.username}">작성자</dt>
          <dd th:text="${#temporals.format(review.creDate, 'yyyy.MM.dd')}">
            날짜
          </dd>
        </div>

        <!-- ✅ 본인만 수정/삭제 -->
        <div sec:authorize="isAuthenticated()"
             th:if="${#authentication.name == review.user.userId}">

          <!-- 삭제 -->
          <form th:action="@{/review/delete/{rno}(rno=${review.rno})}"
                method="post"
                style="display:inline;"
                onsubmit="return confirm('삭제할까?');">

            <button class="btn btn-sm btn-outline-danger">
              삭제
            </button>
          </form>
        </div>
      </dl>

    </div>

    <!-- 리뷰 없을 때 -->
    <div th:if="${#lists.isEmpty(reviewList)}"
         class="text-muted">
      아직 리뷰가 없습니다.
    </div>

  </div>
</div>

</body>
</html>
